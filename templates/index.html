<!DOCTYPE html>
<html>
<head>
  <title>Risk Matrix</title>
  <style>
    select, input { margin: 4px; }
    table { border-collapse: collapse; margin-top: 20px; }
    td, th { border: 1px solid #ccc; padding: 6px; }
    .edit select, .edit input { width: 90px; }
    button { margin: 2px; }
  </style>
</head>
<body>

<h2>Add Project</h2>

<form method="post" action="/add">
  <input name="name" placeholder="Project name" required><br>

  {% for d in domains %}
    {{ d }}:
    <select name="{{ d }}">
      <option value="low">Low</option>
      <option value="some">Some</option>
      <option value="high">High</option>
    </select>
  {% endfor %}

  Overall:
  <select name="overall">
    <option value="low">Low</option>
    <option value="some">Some</option>
    <option value="high">High</option>
  </select>

  <button type="submit">Add</button>
</form>

<h2>Projects</h2>

<table>
  <tr>
    <th>Name</th>
    {% for d in domains %}<th>{{ d }}</th>{% endfor %}
    <th>Overall</th>
    <th>Action</th>
  </tr>

  {% for p in projects %}
  <tr id="row-{{ p['id'] }}">
    <form method="post" action="/update/{{ p['id'] }}">
      
      <!-- Name -->
      <td>
        <span class="view">{{ p["name"] }}</span>
        <input class="edit" name="name" value="{{ p['name'] }}" hidden>
      </td>

      <!-- Domains -->
      {% for v in p["values"] %}
      <td>
        <span class="view">{{ v }}</span>
        <select class="edit" name="{{ domains[loop.index0] }}" hidden>
          <option value="low" {% if v=='low' %}selected{% endif %}>Low</option>
          <option value="some" {% if v=='some' %}selected{% endif %}>Some</option>
          <option value="high" {% if v=='high' %}selected{% endif %}>High</option>
        </select>
      </td>
      {% endfor %}

      <!-- Overall -->
      <td>
        <span class="view">{{ p["overall"] }}</span>
        <select class="edit" name="overall" hidden>
          <option value="low" {% if p['overall']=='low' %}selected{% endif %}>Low</option>
          <option value="some" {% if p['overall']=='some' %}selected{% endif %}>Some</option>
          <option value="high" {% if p['overall']=='high' %}selected{% endif %}>High</option>
        </select>
      </td>

      <!-- Actions -->
      <td>
        <button type="button" onclick="editRow('{{ p['id'] }}')" class="view">Edit</button>
        <button type="submit" class="edit" hidden>Save</button>
        <button type="button" onclick="cancelEdit('{{ p['id'] }}')" class="edit" hidden>Cancel</button>
        <a href="/delete/{{ p['id'] }}" class="view">Delete</a>
      </td>

    </form>
  </tr>
  {% endfor %}
</table>


<br>
<a href="/generate">
  <button>Generate Image</button>
</a>
<script>
function editRow(id) {
  document.querySelectorAll(`#row-${id} .view`).forEach(e => e.hidden = true);
  document.querySelectorAll(`#row-${id} .edit`).forEach(e => e.hidden = false);
}

function cancelEdit(id) {
  document.querySelectorAll(`#row-${id} .view`).forEach(e => e.hidden = false);
  document.querySelectorAll(`#row-${id} .edit`).forEach(e => e.hidden = true);
}
</script>
</body>
</html>
